<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title> AKILCI TEDAVİ SÜRECİ DEĞERLENDİRME BASAMAKLARI </title>
  <style>
    :root{
      /* Sıcak & soft tema */
      --bg:#fff8f2;           /* sıcak krem */
      --text:#2b2a28;         /* koyu nötr */
      --muted:#6b665f;        /* sıcak gri */
      --card:#fff2ea;         /* çok açık somon */
      --border:#eadad0;       /* yumuşak bej sınır */
      --accent:#e68a64;       /* sıcak somon/terra */
      --chip:#f9e7db;         /* buton chip bg */
      --chip-active:#e68a64;  /* seçili buton bg */
      --chip-active-text:#fff;
      --neg:#b23a3a;          /* negatif vurgu */

      /* Alternating başlık tonları */
      --tone-0:#fff6e2;   /* soft sarı */
      --tone-1:#ffeae4;   /* soft somon */
      --tone-2:#eef6e9;   /* adaçayı */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(180deg, rgba(255,248,242,.95), rgba(255,248,242,.7) 70%, rgba(255,248,242,0));backdrop-filter:saturate(160%) blur(6px);border-bottom:1px solid var(--border)}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    h1{font-size:clamp(20px,3vw,28px);margin:6px 0 0}
    .sub{color:var(--muted);font-size:14px;margin:4px 0 10px}
    .bar{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:12px;background:#fff}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;margin:12px 0;box-shadow:0 2px 12px rgba(230,138,100,.06)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:center}

    label.small{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--text);font-size:14px}

    .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .badge{font-size:12px;color:var(--muted)}
    .tot{font-weight:700}

    /* Alt başlık (item) kutuları: alternating soft renkler */
    details.item{border:1px solid var(--border);border-radius:14px;margin:10px 0;background:#fff}
    details.item[open]{box-shadow:0 1px 8px rgba(0,0,0,.04)}
    details.item summary{cursor:pointer;list-style:none;padding:10px 12px;border-bottom:1px dashed var(--border);user-select:none}
    details.item summary::-webkit-details-marker{display:none}
    .tone-0 summary{background:linear-gradient(180deg, var(--tone-0), #fff)}
    .tone-1 summary{background:linear-gradient(180deg, var(--tone-1), #fff)}
    .tone-2 summary{background:linear-gradient(180deg, var(--tone-2), #fff)}

    .row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;padding:10px 12px}
    .row:nth-child(odd){background:#fff9f5}

    .btns{display:flex;flex-wrap:wrap;gap:6px}
    .chip{border:1px solid var(--border);background:var(--chip);color:var(--text);padding:8px 10px;border-radius:999px;font-weight:600;font-size:13px;cursor:pointer;user-select:none;transition:transform .04s ease}
    .chip:hover{transform:translateY(-1px)}
    .chip.active{background:var(--chip-active);border-color:#cf7a58;color:var(--chip-active-text)}
    .chip.neg{background:#fde7e7;border-color:#f1caca;color:#8a2a2a}
    .chip.neg.active{background:var(--neg);border-color:#8f2f2f;color:#fff}

    .footer{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{cursor:pointer;border:1px solid var(--border);background:#fff;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600}
    button.accent{border-color:#d97f5d;background:#fff3ee}
    button.danger{border-color:#e6b8b8;background:#fff0f0}

    .totals{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width:640px){
      .grid{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
      .totals{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>AKILCI TEDAVİ SÜRECİ DEĞERLENDİRME BASAMAKLARI</h1>
      <div class="sub">Çevrimdışı · Mobil uyumlu · JSON/CSV dışa aktarım</div>
      <div class="bar">
        <span class="pill">Toplam Puan: <strong id="overall">0</strong> / <span id="overallMax">100</span></span>
        <span class="pill">Sıcak & soft tema</span>
      </div>
    </div>
  </header>

  <main class="wrap" id="app"></main>

  <script>
  // --- Rubrik ---
  const rubric = {
    meta: { title: "AKILCI TEDAVİ SÜRECİ DEĞERLENDİRME BASAMAKLARI", version: "2025-08" },
    fields: [
      { key: "ogrenci", label: "Öğrenci", type: "text", placeholder: "Ad Soyad" },
      { key: "degerlendiren", label: "Değerlendiren", type: "text", placeholder: "Ad Soyad" },
    ],
    sections: [
      {
        key: "problem",
        title: "I. PROBLEM ÇÖZME ADIMLARI",
        items: [
          { key:"p1", title:"1) Problemi Tanımlayın (Tanı)", rows: [
            { key:"p1a", label:"Yüksek tansiyon", options:[0,1,2] },
            { key:"p1b", label:"Nedeni", options:[0,2] },
            { key:"p1c", label:"Kronik", options:[0,2] },
            { key:"p1d", label:"Riskler", options:[0,1,2,3] },
          ]},
          { key:"p2", title:"2) Tedavi amaçlarını belirtin", rows: [
            { key:"p2a", label:" Kan basıncının ……… mmHg olmasının sağlanması", options:[0,1,2] },
            { key:"p2b", label:"Riskin önlenmesi", options:[0,1,2,3] },
          ]},
          { key:"p3", title:"3) İlaç dışı tedavinin anlatılması", rows: [
            { key:"p3a", label:"Tuz kısıtlaması ve bunun tanımlanması", options:[0,1,2] },
            { key:"p3b", label:"Kilo verme / diyet", options:[0,1,2,3] },
            { key:"p3c", label:"Alkol ve sigara kısıtlanması", options:[0,1,2] },
            { key:"p3d", label:"Düzenli egzersiz ve tanımı", options:[0,1,2] },
            { key:"p3e", label:"Kendi başına KB takibi ve nasıl yapılacağı", options:[0,1,2] },
          ]},
          { key:"p4", title:"4) Düşünülen K-ilacın bu hasta için uygunluğunun sorgulanması", rows: [
            { key:"p4a", label:"Kontrendikasyonlar / uygunluk", options:[0,1,2,3,4,5] },
            { key:"p4b", label:"Etkileşme (mevcut ilaçlar/bitkisel ürünler)", options:[0,1,2] },
            { key:"p4c", label:"Maliyet", options:[0,1] },
            { key:"p4d", label:"Gebeliğin sorgulanmaması", options:[0,-5] },
          ]},
          { key:"p5", title:"5) K‑ilacın doğruluğu", rows: [
            { key:"p5a", label:"İlacın ticari ve/veya jenerik adı", options:[0,2] },
            { key:"p5b", label:"Farmasötik şekil ve yitilik", options:[0,1,2] },
            { key:"p5c", label:"Kullanım (sıklık, aç/tok, bol su, çiğnemeden, sabah/akşam,...)", options:[0,1,2,3,4,5] },
            { key:"p5d", label:"Kullanım süresi", options:[0,2] },
          ]},
          { key:"p6", title:"6) Reçete yazımı (reçete sadece format olarak  değerlendirilecektir)", rows: [
            { key:"p6a", label:"Hastanın Kimlik bilgileri / yaş", options:[0,1,2] },
            { key:"p6b", label:"Tarih", options:[0,1] },
            { key:"p6c", label:"Tanı", options:[0,1] },
            { key:"p6d", label:"İlacın ticari/jenerik adı", options:[0,1] },
            { key:"p6e", label:"Dozaj formu", options:[0,1] },
            { key:"p6f", label:"Birim dozaj formunda bulunan ilaç miktarı/konsantrasyon", options:[0,1] },
            { key:"p6g", label:"Verilecek toplam miktar (kutu sayısı)", options:[0,1] },
            { key:"p6h", label:"Dozaj", options:[0,1] },
            { key:"p6i", label:"Kullanım talimatları", options:[0,1] },
            { key:"p6j", label:"Hekimin adı/adresi/İmza", options:[0,1,2,3] },
            { key:"p6k", label:"Reçetede karalama ", options:[0,-3] },
            { key:"p6l", label:"Okunaklı olmaması ", options:[0,-5] },
            { key:"p6m", label:"Kurşun kalem ile yazılması", options:[0,-3] },
            { key:"p6n", label:"Düzensiz olması", options:[0,-2] },
          ]},
          { key:"p7", title:"7) Hastaya sözlü bilgi / talimat / uyarılar", rows: [
            { key:"p7a1", label:"Etkinin ne zaman başlayacağı", options:[0,1] },
            { key:"p7a2", label:"Etkinin ne kadar süreceği", options:[0,1] },
            { key:"p7b1", label:"Etkin madde veya ticari isim", options:[0,1] },
            { key:"p7b2", label:"Nasıl kullanılacak", options:[0,1,2,3] },
            { key:"p7b3", label:"Dozaj", options:[0,1,2] },
            { key:"p7b4", label:"Doz aralığı", options:[0,1] },
            { key:"p7b5", label:"Ne kadar süreyle", options:[0,1] },
            { key:"p7c1", label:"Bu ilacı alırken başka ilaç kullanırsa etkileşebileceği ve doktora danışmadan başka ilaç kullanmaması  ", options:[0,1,2] },
            { key:"p7c2", label:"Akut ve kronik yan tesirlerin olabileceğinin söylenmesi ", options:[0,2,3,4] },
            { key:"p7c3", label:"Yan tesir geliştiğinde ne yapacağının belirtilmesi ", options:[0,1,2] },
            { key:"p7c4", label:"Gebelikten korunması hakkında bilgi verilmesi", options:[0,6] },
            { key:"p7c5", label:"Gebe kalırsa hemen doktora başvurması hakkında bilgi vermezse ", options:[0,-5] },
            { key:"p7d1", label:"Sonraki randevuya ne zaman, nasıl gelmeli (reçete ve kan basıncı takip çizelgesi ile)", options:[0,1,2,3] },
            { key:"p7e1", label:"Bilgilendirme doğru ilaca göre yapıldı mı?", options:[4,-4] },
          ]},
        ]
      },
      {
        key: "iletisim",
        title: "II. İLETİŞİM BECERİSİ",
        items: [
          { key:"i1", title:"İletişim", rows:[
            { key:"i1a", label:"Açık ve anlaşılır konuşma; tıbbi terimlerden kaçınma; soruları yanıtlama", options:[0,1,2,3] },
            { key:"i1b", label:"Hastaya bilgileri sistematik olarak anlatma Hastanın sağlık probleminin tanımlanması. Tedavi hedeflerinin belirlenmesi. Non-farmakolojik tedavi ile ilgili bilgilendirme. Farmakolojik tedavi ile ilgi bilgi verme. Kontrole çağırma.", options:[0,1,2,3] },
            { key:"i1c", label:"Hastanın ve/veya yakınının talimatları anladığında emin olma", options:[0,1,2,3] },
            { key:"i1d", label:"Hasta ve/veya yakınına talimatları tekrar ettirme", options:[0,1,2,3] },
          ]}
        ]
      }
    ]
  };

  // --- Durum ---
  const state = { scores: {}, meta: { ogrenci:"", degerlendiren:"" } };
  const AUTO_KEY = 'noks_autosave';
  try {
    const saved = JSON.parse(localStorage.getItem(AUTO_KEY) || 'null');
    if (saved) {
      state.meta = saved.meta || state.meta;
      state.scores = saved.scores || state.scores;
    }
  } catch (err) { console.warn('Autosave yüklenemedi', err); }
  function autoSave(){
    localStorage.setItem(AUTO_KEY, JSON.stringify({meta: state.meta, scores: state.scores}));
  }

  // --- Yardımcılar ---
  const el = (tag, attrs={}, children=[]) => {
    const e = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (k === 'class') e.className = v; else if (k === 'html') e.innerHTML = v; else if (k.startsWith('on')) e.addEventListener(k.slice(2),v); else e.setAttribute(k,v);
    }
    for (const c of [].concat(children)) if (c!==null && c!==undefined) e.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
    return e;
  };

  function sectionTotal(section){
    let t = 0;
    for(const item of section.items){
      for(const row of item.rows){
        const key = row.key;
        const v = Number(state.scores[key] ?? 0);
        if (!Number.isNaN(v)) t += v;
      }
    }
    return t;
  }
  function overallTotal(){
    return rubric.sections.reduce((acc,s)=>acc+sectionTotal(s),0);
  }

  function saveLocal(){
    const id = (state.meta.ogrenci || 'ogrenci') + '__' + (state.meta.degerlendiren || 'degerlendiren');
    const safe = id.replace(/[^A-Za-z0-9_]+/g,'_');
    const blob = { rubric: rubric.meta, meta: state.meta, scores: state.scores, total: overallTotal(), ts: new Date().toISOString() };
    localStorage.setItem('noks_form_'+safe, JSON.stringify(blob));
    alert('Kaydedildi (bu cihaza).');
  }
  function exportJSON(){
    const data = { rubric: rubric.meta, meta: state.meta, scores: state.scores, totals: sectionTotals(), overall: overallTotal() };
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([JSON.stringify(data,null,2)], {type:'application/json'}));
    const safe = (state.meta.ogrenci||'ogrenci').replace(/[^A-Za-z0-9_]+/g,'_');
    a.download = 'degerlendirme_'+safe+'.json';
    a.click();
  }
  function exportCSV(){
    const lines = [];
    lines.push(['Alan','Anahtar','Puan'].join(','));
    for(const s of rubric.sections){
      for(const it of s.items){
        for(const r of it.rows){
          const val = state.scores[r.key] ?? '';
          lines.push([`${s.title} › ${it.title}`.replace(/,/g,';'), r.label.replace(/,/g,';'), val].join(','));
        }
      }
    }
    lines.push(['TOPLAM','', overallTotal()].join(','));
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([lines.join('\n')], {type:'text/csv'}));
    const safe = (state.meta.ogrenci||'ogrenci').replace(/[^A-Za-z0-9_]+/g,'_');
    a.download = 'degerlendirme_'+safe+'.csv';
    a.click();
  }
  function sectionTotals(){
    const map = {};
    for(const s of rubric.sections){ map[s.title] = sectionTotal(s); }
    return map;
  }
  function resetForm(){
    if(!confirm('Tüm seçimler sıfırlansın mı?')) return;
    state.scores = {}; document.querySelectorAll('.btns').forEach(g=>{
      g.querySelectorAll('.chip').forEach(btn=>btn.classList.remove('active'))
    });
    document.getElementById('overall').textContent = overallTotal();
    document.querySelectorAll('[id^=tot_]').forEach(t=>t.textContent = '0 puan');
    autoSave();
  }

  // --- Arayüz Kurulumu ---
  const app = document.getElementById('app');

  // Kimlik alanları
  const idCard = el('div',{class:'card'},[
    el('div',{class:'grid'},[
      el('div',{},[
        el('label',{class:'small'},['Öğrenci']),
        el('input',{type:'text',placeholder:'Ad Soyad',id:'ogrenci',value:state.meta.ogrenci||'',oninput:e=>{ state.meta.ogrenci=e.target.value; autoSave(); }})
      ]),
      el('div',{},[
        el('label',{class:'small'},['Değerlendiren']),
        el('input',{type:'text',placeholder:'Ad Soyad',id:'degerlendiren',value:state.meta.degerlendiren||'',oninput:e=>{ state.meta.degerlendiren=e.target.value; autoSave(); }})
      ]),
    ]),
    el('div',{class:'footer'},[
      el('button',{onclick:()=>saveLocal(),class:'accent'},['Kaydet (Cihazda)']),
      el('button',{onclick:()=>exportJSON()},['JSON Dışa Aktar']),
      el('button',{onclick:()=>exportCSV()},['CSV Dışa Aktar']),
      el('button',{onclick:()=>window.print()},['PDF Yazdır']),
      el('button',{onclick:()=>resetForm(),class:'danger'},['Sıfırla'])
    ])
  ]);
  app.appendChild(idCard);

  // Bölümler
  rubric.sections.forEach(section=>{
    const card = el('div',{class:'card'});
    const header = el('div',{class:'section-title'},[
      el('div',{class:'tot'},[section.title]),
      el('div',{class:'badge', id:'tot_'+section.key},['0 puan'])
    ]);
    card.appendChild(header);

    section.items.forEach((item, idx)=>{
      const box = el('details',{class:'item tone-'+(idx%3), open:true});
      box.appendChild(el('summary',{},[item.title]));

      item.rows.forEach(row=>{
        const r = el('div',{class:'row'});
        r.appendChild(el('label',{},[row.label]));

        // İşaretlenebilir butonlar
        const group = el('div',{class:'btns', role:'radiogroup','aria-label':row.label});
        const uniqueVals = [...new Set(row.options)];
        uniqueVals.forEach(v=>{
          const btn = el('button',{type:'button', class:'chip'+(v<0?' neg':''), 'data-key':row.key, 'data-val':String(v), 'aria-pressed':'false'},[String(v)]);
          if (state.scores[row.key] === Number(v)){
            btn.classList.add('active');
            btn.setAttribute('aria-pressed','true');
          }
          btn.addEventListener('click',()=>{
            group.querySelectorAll('.chip').forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
            btn.classList.add('active');
            btn.setAttribute('aria-pressed','true');
            state.scores[row.key] = Number(v);
            document.getElementById('tot_'+section.key).textContent = sectionTotal(section) + ' puan';
            document.getElementById('overall').textContent = overallTotal();
            autoSave();
          });
          group.appendChild(btn);
        });
        r.appendChild(group);
        box.appendChild(r);
      });
      card.appendChild(box);
    });

    app.appendChild(card);
    document.getElementById('tot_'+section.key).textContent = sectionTotal(section) + ' puan';
  });

  // Başlangıç: toplamlar
  document.getElementById('overallMax').textContent = 100;
  document.getElementById('overall').textContent = overallTotal();
  </script>
</body>
</html>
